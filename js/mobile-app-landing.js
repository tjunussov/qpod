/**
 * Fiverr Mobile App Landing
 * Handles mobile app landing behaviour
 *
 * Dependencies:
 * - jQuery 1.91
 * - Modernizr
 *
 */
(function(e){var n={isMobile:navigator.userAgent.match(/(?:iPhone|iPad|iPod|Android|Android)/i)!=null,isAndroid:navigator.userAgent.match(/(?:Android)/i)!=null,clickEventType:"",init:function(){var t=this;t.isMobile?(t.landscapeDetection(),t.handleOrientation(),e(".btn-get-app").on(n.clickEventType,function(){n.pushGoogleTag("landing-page-mobile","ios-promo","get-the-app")})):(t.initSlider(),t.initSmsForm(),t.initAndroidForm(),e(".btn-get-app.ios").on(n.clickEventType,function(){n.pushGoogleTag("landing-page-desktop","ios-promo","app-store-button")}),e(".js-send-sms").on(n.clickEventType,function(){n.pushGoogleTag("landing-page-desktop","ios-promo","get-the-app")}))},initSlider:function(){var r=e(".slider"),i=r.find("nav"),s=r.parent().find(".slider-arrow"),o=1,u=4,a=!0,f=!1,l=5e3,c=1e4,h="",p=function(e){if(isNaN(e))return;r.attr("class","slider slide-"+e),i.find("a").attr("class","").filter("[data-slide="+e+"]").addClass("sel"),o=e,f=e===u,a=e===1,d()},d=function(){s.hide(),f||s.filter('[data-slide="next"]').show(),a||s.filter('[data-slide="prev"]').show()},v=function(e){t=e?c:l,clearInterval(h),h=setInterval(function(){o<u?p(o+1):p(1),e&&v()},t)};i.find("a").on(n.clickEventType,function(t){t.preventDefault();var n=e(this).data("slide");p(n),v(!0)}),s.on(n.clickEventType,function(t){t.preventDefault();var n=e(this).data("slide");n==="next"?p(o+1):n==="prev"&&p(o-1),v(!0)}),d(),v()},initSmsForm:function(){var t=this,r=/^[+]?\d*[(]?\d*[-() ]?\d*[-) ]?\d*[- ]?\d$/,i=e(".slider-form"),s=i.find(".js-send-sms"),o=i.find('input[name="phone-num"]'),u=i.find('input[name="country-code"]');o.focus(),o.keypress(function(e){e.keyCode==13&&s.trigger("click")});var a=function(t,n){if(isNaN(t))return;n=n||"IL",e.ajax({url:"/l/send_download_mobile_ios_app_sms",type:"post",data:{phone_num:t,country_code:n},success:function(){i.html(""),i.append('<p class="success-msg">Please check your iPhone\'s SMS to download the app.</p>')},error:function(){s.removeClass("disabled"),alert("Please try again")}})};s.on(n.clickEventType,function(e){e.preventDefault();if(s.hasClass("disabled"))return;s.addClass("disabled");var n=o.val();n=t.processPhone(n),n.length>=6?(i.removeClass("with-error"),a(n,u.val())):(i.addClass("with-error"),s.removeClass("disabled"))})},initAndroidForm:function(){var t=/^([a-zA-Z0-9\.\-\+\_])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,r=e(".btn-get-app"),i=r.find('input[type="text"]');r.one(n.clickEventType,function(){r.toggleClass("active")}),i.keypress(function(e){var t=i.val();e.keyCode==13&&s(t)});var s=function(n){r.find(".err-msg").remove();if(!t.test(n)){r.addClass("active"),r.append('<p class="err-msg">Please enter a vaild email address.</p>');return}i.attr("disabled",!0),e.ajax({url:"/l/collect_android_email",type:"post",data:{email:n},success:function(){r.removeClass("active"),r.append('<p class="success-msg">Good things to come... stay tuned.</p>')},error:function(){i.attr("disabled",!1),alert("Please try again")}})}},processPhone:function(e){var t="US";return formatE164(t,e)},handleOrientation:function(){var e=this,t=n.isAndroid?"resize":"orientationchange";window.addEventListener(t,function(t){e.landscapeDetection()},!1)},landscapeDetection:function(){n.isAndroid&&screen.width>screen.height||window.orientation==90||window.orientation==-90?e("html").addClass("mobile-landscape"):e("html").removeClass("mobile-landscape")},pushGoogleTag:function(e,t,r,i){var s=n.prepareGoogleTagData(e,t,r,i);typeof dataLayer!="undefined"&&dataLayer.push(s)},prepareGoogleTagData:function(e,t,n,r){var i={action:e,event:t};return n&&(i.label=n.toLowerCase()),r&&(i.value=r.toLowerCase()),i}};window.FiverrAppLanding=n,e(document).ready(function(){n.clickEventType=n.isMobile?"touchstart":"click",n.init()})})(jQuery);